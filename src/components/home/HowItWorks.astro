---
import type { TemplateConfig } from "@utils/configType";
import type { TranslationObject } from "@utils/serverI18n";

interface Props {
  config: TemplateConfig;
  translations: TranslationObject;
  currentLang?: string;
}

const { config, translations } = Astro.props as Props;

const {
  home: { howItWorks },
} = config;

if (!howItWorks) {
  return null;
}

const stepAltTexts = [
  translations.alt.steps.step1,
  translations.alt.steps.step2,
  translations.alt.steps.step3,
  translations.alt.steps.step4,
  translations.alt.steps.step5,
];

const steps = howItWorks.steps.map((step, i) => ({
  image: step.image,
  key: `step${i + 1}`,
  alt: stepAltTexts[i] || translations.alt.misc.appScreenshot,
}));
---

<section
  id={howItWorks.id}
  class="mx-auto max-w-screen-lg px-4 py-12"
  aria-label={translations.aria.sections.howItWorks}
  data-interactive="animations"
>
  <div class="mb-12 flex max-w-none flex-col items-center text-center">
    <h2 class="mb-3 font-normal">{translations.howItWorks.title}</h2>
    <div class="h-2 w-[200px] overflow-hidden rounded-full bg-gradient-to-r from-primary to-secondary md:w-[350px]">
      <span class="block h-full w-full bg-white/20"></span>
    </div>
    <p class="mt-3 max-w-lg text-md text-base-content/70">{translations.howItWorks.subtitle}</p>
  </div>

  <div class="flex flex-col gap-52">
    {steps.map((step, index) => {
      const stepCopy = translations.howItWorks[step.key as keyof typeof translations.howItWorks] as {
        title: string;
        description: string;
      };
      const isEven = index % 2 === 0;

      return (
        <article
          class={`relative flex flex-col items-center gap-12 rounded-3xl bg-base-200/40 dark:bg-neutral px-8 pb-8 pt-3 md:flex-row md:pt-8 ${isEven ? "md:flex-row-reverse" : ""}`}
          data-animate="slide-up"
          data-threshold="0.2"
          data-once="true"
        >
          {index < steps.length - 1 && (
            <>
              <!-- Desktop: Alternating swirl arrows -->
              <div
                class="absolute -bottom-44 left-1/2 hidden w-48 -translate-x-1/2 text-primary md:block"
                data-animate="scale-in"
                data-threshold="0.5"
                data-once="true"
              >
                {isEven ? (
                  <!-- SwirlArrowBottomRight -->
                  <svg viewBox="0 0 512 442.137">
                    <path
                      fill="currentColor"
                      d="M498.536 442.137c-31.387-25.229-67.042-47.435-83.064-62.714-5.282-5.036-11.007-12.153-1.664-8.574 25.872 9.909 54.004 27.667 75.003 49.744-2.547-18.498 2.366-41.616 9.997-60.504.939-2.328 3.886-11.918 7.547-15.089 1.358-1.177 2.819-1.472 4.307-.18.849.739 1.28 1.995 1.333 3.707.152 4.983-3.387 19.558-6.693 33.835-4.904 21.183-7.422 37.783-6.766 59.775z"
                    />
                    <path
                      fill="currentColor"
                      d="M243.828 236.348c4.322-22.157 5.797-44.278 4.95-66.742 45.792 16.983 86.744 47.759 120.988 82.094 41.377 41.487 75.893 91.781 100.677 142.434 7.709 15.756 12.142 22.106 22.781 36.215-19.821-95.783-137.213-251.196-246.698-274.194C232.218 29.162 103.055-53.717 0 40.704c95.353-64.986 210.522-25.748 234.658 113.48-11.685-1.414-23.233-1.219-34.515.824-26.693 4.83-52.462 12.782-72.736 38.719-28.125 35.979-26.324 94.975 19.286 115.587 54.862 24.792 87.927-25.739 97.135-72.966zm-7.016-67.487c.889 23.575-1.128 48.171-6.111 71.196-8.03 37.107-29.726 69.192-65.407 62.82-22.084-3.943-35.695-18.675-40.56-38.116-17.522-70.029 62.617-107.875 112.078-95.9z"
                    />
                  </svg>
                ) : (
                  <!-- SwirlArrowBottomLeft -->
                  <svg viewBox="0 0 512 442.136">
                    <path
                      fill="currentColor"
                      d="M13.465 442.136c31.386-25.228 67.041-47.435 83.064-62.714 5.281-5.036 11.006-12.153 1.663-8.574-25.872 9.91-54.003 27.668-75.003 49.745 2.547-18.499-2.366-41.616-9.997-60.505-.938-2.328-3.886-11.918-7.546-15.088-1.359-1.177-2.82-1.473-4.308-.18-.849.738-1.279 1.995-1.333 3.707-.152 4.982 3.388 19.557 6.693 33.834 4.905 21.183 7.422 37.783 6.767 59.775z"
                    />
                    <path
                      fill="currentColor"
                      d="M268.172 236.348c-4.322-22.157-5.797-44.278-4.95-66.742-45.792 16.982-86.744 47.758-120.988 82.094-41.377 41.487-75.893 91.78-100.677 142.433-7.709 15.756-12.142 22.106-22.78 36.216 19.82-95.783 137.212-251.197 246.697-274.194C279.782 29.162 408.945-53.716 512 40.704c-95.354-64.986-210.522-25.748-234.658 113.479 11.685-1.413 23.233-1.218 34.515.824 26.693 4.831 52.462 12.783 72.736 38.719 28.125 35.979 26.324 94.976-19.286 115.588-54.862 24.792-87.927-25.74-97.135-72.966zm7.016-67.488c-.889 23.576 1.128 48.171 6.111 71.196 8.03 37.107 29.726 69.192 65.407 62.821 22.084-3.944 35.695-18.675 40.56-38.117 17.522-70.029-62.617-107.875-112.078-95.9z"
                    />
                  </svg>
                )}
              </div>

              <!-- Mobile: Simple down arrow -->
              <div
                class="absolute -bottom-48 left-1/2 w-16 -translate-x-1/2 text-primary md:hidden"
                data-animate="scale-in"
                data-threshold="0.5"
                data-once="true"
              >
                <svg fill-rule="evenodd" viewBox="0 0 190 511.232">
                  <path
                    fill="currentColor"
                    d="M62.175 511.232c3.498-32.16 11.139-65.029 11.559-82.81.14-5.862-.65-13.156-3.923-5.817-7.903 17.716-13.395 39.79-14.27 61.369-1.074-4.78-2.469-9.534-4.675-15.969-14.695-42.852-23.659-91.029-23.721-138.1-.052-38.957 5.728-79.703 22.093-115.362 12.281 13.243 25.685 24.969 40.725 35.101 32.059 21.597 79.546 31.519 96.629-13.73 14.199-37.618-18.291-72.153-54.706-76.615-26.25-3.217-45.406 6.905-63.312 19.323-7.57 5.25-14.241 11.699-20.074 19.139C-16.88 104.961 26.254 17.25 117.335 0 5.158 4.903-21.132 125.356 42.877 205.623c-45.933 70.364-30.038 210.397 7.49 281.987-9.277-9.448-22.412-17.508-34.953-22.831-1.856-.789-8.98-4.562-12.858-4.284-1.442.101-2.439.765-2.55 2.345-.063.901.406 1.86 1.348 2.863 2.745 2.916 13.033 9.185 23.023 15.417 14.819 9.247 25.678 17.246 37.798 30.112zm-6.562-303.91c12.887 13.897 28.005 26.723 43.915 36.972 25.64 16.517 56.191 22.419 72.841-1.47 10.303-14.784 9.667-30.885 1.387-44.692-29.827-49.734-96.848-25.709-118.143 9.19z"
                  />
                </svg>
              </div>
            </>
          )}

          <div class={`flex flex-1 ${isEven ? "justify-center md:justify-end" : "justify-center md:justify-start"}`}>
            <img
              class="max-w-xs rounded-3xl shadow-lg md:max-w-sm"
              src={step.image}
              width="400"
              height="300"
              loading="lazy"
              alt={step.alt}
            />
          </div>
          <div class="flex flex-1 flex-col items-center text-center md:items-start md:text-left">
            <div class="font-sketch text-6xl text-primary md:text-7xl">
              {index + 1 < 10 ? `0${index + 1}` : index + 1}
            </div>
            <h3 class="mt-2 text-2xl font-bold text-base-content">{stepCopy?.title}</h3>
            <p class="mt-3 max-w-md text-base text-base-content/70">{stepCopy?.description}</p>
          </div>
        </article>
      );
    })}
  </div>
</section>
