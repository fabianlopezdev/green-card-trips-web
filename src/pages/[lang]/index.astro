---
import BaseLayout from "@layouts/BaseLayout.astro";
import defaultTemplateConfig from "@utils/config";
import { generateFAQPageSchema, generateReviewSchema, generateProductSchema } from "@utils/structuredData";
import { getTranslations, getSupportedLanguages } from "@utils/serverI18n";
import Hero from "@components/home/Hero/Hero.astro";
import Highlight from "@components/home/Highlight.astro";
import Features from "@components/home/Features.astro";
import HowItWorks from "@components/home/HowItWorks.astro";
import Pricing from "@components/home/Pricing.astro";
import Testimonials from "@components/home/Testimonials.astro";
import Faq from "@components/home/FAQ/FAQ.astro";

export function getStaticPaths() {
  const languages = getSupportedLanguages();

  // Exclude 'en' since English is at root level (/)
  return languages
    .filter(lang => lang !== 'en')
    .map(lang => ({
      params: { lang },
      props: {
        lang,
        translations: getTranslations(lang),
      }
    }));
}

const { lang } = Astro.params;
const { translations } = Astro.props;

// Generate FAQPage schema with language-specific FAQ content
const faqs = [
  { question: translations.faq.q1.question, answer: translations.faq.q1.answer },
  { question: translations.faq.q2.question, answer: translations.faq.q2.answer },
  { question: translations.faq.q3.question, answer: translations.faq.q3.answer },
  { question: translations.faq.q4.question, answer: translations.faq.q4.answer },
  { question: translations.faq.q5.question, answer: translations.faq.q5.answer },
  { question: translations.faq.q6?.question, answer: translations.faq.q6?.answer },
  { question: translations.faq.q7?.question, answer: translations.faq.q7?.answer },
  { question: translations.faq.q8?.question, answer: translations.faq.q8?.answer },
].filter(faq => faq.question && faq.answer);
const faqSchema = generateFAQPageSchema(faqs);

// Generate Review schemas for testimonials
const reviewSchemas = generateReviewSchema(defaultTemplateConfig);

// Generate Product schema for pricing with production URL
const siteUrl = Astro.site || new URL(Astro.url.origin);
const currentPageUrl = new URL(Astro.url.pathname, siteUrl).href;
const productSchema = generateProductSchema(defaultTemplateConfig, currentPageUrl);
---

<BaseLayout {...defaultTemplateConfig} currentLang={lang} translations={translations}>
  <!-- FAQPage Structured Data -->
  <script is:inline type="application/ld+json" set:html={JSON.stringify(faqSchema)} slot="head" />

  <!-- Review Structured Data for Testimonials -->
  {reviewSchemas.map((review) => (
    <script is:inline type="application/ld+json" set:html={JSON.stringify(review)} slot="head" />
  ))}

  <!-- Product Structured Data -->
  <script is:inline type="application/ld+json" set:html={JSON.stringify(productSchema)} slot="head" />

  <Hero config={defaultTemplateConfig} translations={translations} currentLang={lang} />
  <Highlight config={defaultTemplateConfig} translations={translations} currentLang={lang} />
  <Features config={defaultTemplateConfig} translations={translations} currentLang={lang} />
  <HowItWorks config={defaultTemplateConfig} translations={translations} currentLang={lang} />
  <Pricing config={defaultTemplateConfig} translations={translations} currentLang={lang} />
  <Testimonials config={defaultTemplateConfig} />
  <Faq config={defaultTemplateConfig} translations={translations} currentLang={lang} />
</BaseLayout>
